(()=>{"use strict";class t{#t=0;#e=0;#n=0;constructor(t){this.#t=this.#e=t}get alive(){return void 0===this.#t||this.#t>0}step(t,e,n,s,i){if(void 0===this.#t)this.effect(e,n,s,i);else{if(this.#t<=0)return;this.#n||(this.#n=t),this.effect(e,n,s,i,this.#t/this.#e),this.#t-=t-this.#n,this.#n=t}}effect(t,e,n,s,i=1){}}const e=Object.freeze({Manager:class{#s=null;#i=null;#a=[];constructor(t){if(this.#s=t,!this.#s.getContext)throw new Error("Not support the canvas element.");this.#i=new ImageData(t.width,t.height)}updateSize(){this.#i=new ImageData(this.#s.width,this.#s.height)}add(t){this.#a.push(t)}step(t){if(!this.#a.length)return;const e=this.#s.width,n=this.#s.height,s=this.#s.getContext("2d"),i=s.getImageData(0,0,e,n),a=new Uint32Array(i.data.buffer),r=new Uint32Array(this.#i.data.buffer);for(let s=0;s<this.#a.length;++s)s>0&&a.set(r),this.#a[s].step(t,a,r,e,n);this.#a=this.#a.filter((t=>t.alive)),s.putImageData(this.#i,0,0)}},Wave:class extends t{#r=0;#c=0;#o=0;#d=0;#h=0;constructor(t,e,n=1e3,s=16,i=2048,a=4){super(n),this.#r=t,this.#c=e,this.#o=s,this.#d=i,this.#h=a}effect(t,e,n,s,i=1){this.#f(t,e,n,s,this.#r,this.#c,this.#o,i*this.#d,i*this.#h)}#f(t,e,n,s,i,a,r,c,o){const d=r/Math.sqrt(n*n+s*s)*Math.PI*2;let h=0;o*=2*Math.PI;for(let r=0;r<s;++r){const f=a-r;for(let a=0;a<n;++a){const l=i-a,u=l*l+f*f,m=h+a;if(u){const i=Math.sin(Math.sqrt(u)*d+o)*c/u;let h=a+Math.round(i*l),g=r+Math.round(i*f);h<0?h=0:h>=n&&(h=n-1),g<0?g=0:g>=s&&(g=s-1),e[m]=t[g*n+h]}else e[m]=t[m]}h+=n}}},Impact:class extends t{#r=0;#c=0;#l=0;#u=0;#m=void 0;#o=0;#d=0;#h=0;constructor(t,e,n=5,s,i=2,a=1e3,r=16,c=2048,o=4){super(a),this.#r=t,this.#c=e,this.#l=n,this.#m=s,this.#u=i,this.#o=r,this.#d=c,this.#h=o}effect(t,e,n,s,i=1){let a=this.#m;void 0===a&&(a=Math.sqrt((n>>1)**2+(s>>1)**2));const r=i**this.#l;a*=1-r,this.#f(t,e,n,s,this.#r,this.#c,this.#o,this.#d,this.#h,a,r*this.#u)}#f(t,e,n,s,i,a,r,c,o,d,h){const f=r/Math.sqrt(n*n+s*s)*Math.PI*2;let l=0;o*=2*Math.PI;for(let r=0;r<s;++r){const u=a-r;for(let a=0;a<n;++a){const m=i-a,g=m*m+u*u,w=l+a;let p=w;if(g){const t=Math.sqrt(g);if(t<d-h||t>d+h)continue;const e=Math.sin(t*f+o)*c/g;let i=a+Math.round(e*m),l=r+Math.round(e*u);i<0?i=0:i>=n&&(i=n-1),l<0?l=0:l>=s&&(l=s-1),p=l*n+i}e[w]=t[p]}l+=n}}},PerlinNoise:class extends t{#g=0;#w=null;constructor(t,e=1){super(t),this.#g=e,this.#w=this.#p}effect(t,e,n,s,i=1){this.#f(t,e,n,s,this.#g*i)}#f(t,e,n,s,i){for(let a=0;a<s;++a)for(let r=0;r<n;++r){const c=a*n+r,o=t[c],d=255&o,h=o>>8&255,f=o>>16&255,l=this.#v(r/n*4,a/s*4)*i+1,u=d*l>255?255:d*l,m=h*l>255?255:h*l,g=f*l>255?255:f*l;e[c]=u|m<<8|g<<16|255<<24}}get#p(){const t=[...Array(256)].map(((t,e)=>e));for(const e in t){const n=Math.random()*t.length|0;[t[e],t[n]]=[t[n],t[e]]}return t.concat(t)}#y(t,e,n){const s=t=>t*t*t*(t*(6*t-15)+10),i=(t,e,n)=>e+t*(n-e),a=(t,e,n,s)=>{const i=(t&=15)<8?e:n,a=t<4?n:12==t||14==t?e:s;return(0==(1&t)?i:-i)+(0==(2&t)?a:-a)},r=255&t,c=255&e,o=255&n,d=t-(0|t),h=e-(0|e),f=n-(0|n),l=s(d),u=s(h),m=s(f),g=this.#w,w=g[r+0]+c,p=g[w]+o,v=g[w+1]+o,y=g[r+1]+c,E=g[y]+o,I=g[y+1]+o;return i(m,i(u,i(l,a(g[p],d,h,f),a(g[E],d-1,h,f)),i(l,a(g[v],d,h-1,f),a(g[I],d-1,h-1,f))),i(u,i(l,a(g[p+1],d,h,f-1),a(g[E+1],d-1,h,f-1)),i(l,a(g[v+1],d,h-1,f-1),a(g[I+1],d-1,h-1,f-1))))}#v(t,e=0,n=0,s=1,i=.5){let a=0,r=1,c=1,o=0;for(let d=0;d<s;++d)a+=this.#y(t*r,e*r,n*r)*c,o+=c,c*=i,r*=2;return a/o}},Grayscale:class extends t{#g=0;constructor(t,e=1){super(t),this.#g=e}effect(t,e,n,s,i=1){this.#f(t,e,n,s,this.#g*i)}#f(t,e,n,s,i){const a=1-i;for(let r=0;r<s;++r)for(let s=0;s<n;++s){const c=r*n+s,o=t[c],d=255&o,h=o>>8&255,f=o>>16&255,l=(.2126*d+.7152*h+.0722*f)*i;e[c]=d*a+l|h*a+l<<8|f*a+l<<16|255<<24}}}});let n=!1;const s={force:0,radius:0,weight:0,duration:0,cycle:0,amplitude:0,offset:0};addEventListener("load",(()=>{const t=t=>{const e=Number(document.getElementById(t).value);s[t]=e,document.getElementById(`now:${t}`).textContent=e};n=document.getElementById("auto").checked,t("force"),t("radius"),t("weight"),t("duration"),t("cycle"),t("amplitude"),t("offset");const i=document.getElementById("canvas"),a=document.getElementById("image"),r=new e.Manager(i),c=new Image;c.src=a.value,c.addEventListener("load",(()=>{i.width=c.width,i.height=c.height,r.updateSize()}),!1),a.addEventListener("change",(t=>c.src=t.currentTarget.value)),i.addEventListener("mousedown",(t=>{const n=(t=t||window.event).offsetX||t.layerX-t.target.offsetLeft||0,a=t.offsetY||t.layerY-t.target.offsetTop||0;let c=s.radius;c=c?i.clientWidth>=i.clientHeight?i.clientWidth*c:i.clientHeight*c:void 0,r.add(new e.Impact(n,a,s.force,c,s.weight,s.duration,s.cycle,s.amplitude,s.offset))})),r.add(new e.Grayscale(1e3,1)),r.add(new e.PerlinNoise(1e4,1));const o=document.getElementById("fps");let d,h,f=0,l=0;const u=t=>{if(!c||!c.complete)return void setTimeout((()=>requestAnimationFrame(u)),500);void 0===d&&(d=t),f+=1e3/(t-d),++l,d=t,void 0===h&&(h=t);let a=t-h>=1e3;a&&(h=t),a&&(o.textContent=`${i.width}x${i.height}: ${(f/l*1e3|0)/1e3} fps`,f=0,l=0,n&&r.add(new e.Wave(Math.random()*i.clientWidth,Math.random()*i.clientHeight,s.duration,s.cycle,s.amplitude,s.offset))),i.getContext("2d").drawImage(c,0,0,i.clientWidth,i.clientHeight),r.step(t),requestAnimationFrame(u)};requestAnimationFrame(u)})),document.getElementById("auto").addEventListener("click",(function(t){n=this.checked}));const i=t=>{if(!s||!t.currentTarget)return;const e=Number(t.currentTarget.value),n=t.currentTarget.id;s[n]=e,document.getElementById(`now:${n}`).textContent=e};document.getElementById("force").addEventListener("change",i),document.getElementById("radius").addEventListener("change",i),document.getElementById("weight").addEventListener("change",i),document.getElementById("duration").addEventListener("change",i),document.getElementById("cycle").addEventListener("change",i),document.getElementById("amplitude").addEventListener("change",i),document.getElementById("offset").addEventListener("change",i)})();
//# sourceMappingURL=main.js.map