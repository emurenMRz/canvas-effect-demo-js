(()=>{"use strict";class t{#t=0;#e=0;#s=0;constructor(t){this.#t=this.#e=t}get alive(){return void 0===this.#t||this.#t>0}step(t,e,s,i,n){if(void 0===this.#t)this.effect(e,s,i,n);else{if(this.#t<=0)return;this.#s||(this.#s=t),this.effect(e,s,i,n,this.#t/this.#e),this.#t-=t-this.#s,this.#s=t}}effect(t,e,s,i,n=1){}}const e=Object.freeze({Manager:class{#i=null;#n=null;#a=[];constructor(t){if(this.#i=t,!this.#i.getContext)throw new Error("Not support the canvas element.");this.#n=new ImageData(t.width,t.height)}updateSize(){this.#n=new ImageData(this.#i.width,this.#i.height)}add(t){this.#a.push(t)}step(t){if(!this.#a.length)return;const e=this.#i.width,s=this.#i.height,i=this.#i.getContext("2d"),n=i.getImageData(0,0,e,s),a=new Uint32Array(n.data.buffer),c=new Uint32Array(this.#n.data.buffer);for(let i=0;i<this.#a.length;++i)i>0&&a.set(c),this.#a[i].step(t,a,c,e,s);this.#a=this.#a.filter((t=>t.alive)),i.putImageData(this.#n,0,0)}},Wave:class extends t{#c=0;#r=0;#d=0;#o=0;#h=0;constructor(t,e,s=1e3,i=16,n=2048,a=4){super(s),this.#c=t,this.#r=e,this.#d=i,this.#o=n,this.#h=a}effect(t,e,s,i,n=1){this.#f(t,e,s,i,this.#c,this.#r,this.#d,n*this.#o,n*this.#h)}#f(t,e,s,i,n,a,c,r,d){const o=c/Math.sqrt(s*s+i*i)*Math.PI*2;let h=0;d*=2*Math.PI;for(let c=0;c<i;++c){const f=a-c;for(let a=0;a<s;++a){const u=n-a,l=u*u+f*f,m=h+a;if(l){const n=Math.sin(Math.sqrt(l)*o+d)*r/l;let h=a+Math.round(n*u),g=c+Math.round(n*f);h<0?h=0:h>=s&&(h=s-1),g<0?g=0:g>=i&&(g=i-1),e[m]=t[g*s+h]}else e[m]=t[m]}h+=s}}},Impact:class extends t{#c=0;#r=0;#u=0;#l=0;#m=void 0;#d=0;#o=0;#h=0;constructor(t,e,s=5,i,n=2,a=1e3,c=16,r=2048,d=4){super(a),this.#c=t,this.#r=e,this.#u=s,this.#m=i,this.#l=n,this.#d=c,this.#o=r,this.#h=d}effect(t,e,s,i,n=1){let a=this.#m;void 0===a&&(a=Math.sqrt((s>>1)**2+(i>>1)**2));const c=n**this.#u;a*=1-c,this.#f(t,e,s,i,this.#c,this.#r,this.#d,this.#o,this.#h,a,c*this.#l)}#f(t,e,s,i,n,a,c,r,d,o,h){const f=c/Math.sqrt(s*s+i*i)*Math.PI*2;let u=0;d*=2*Math.PI;for(let c=0;c<i;++c){const l=a-c;for(let a=0;a<s;++a){const m=n-a,g=m*m+l*l,w=u+a;let v=w;if(g){const t=Math.sqrt(g);if(t<o-h||t>o+h)continue;const e=Math.sin(t*f+d)*r/g;let n=a+Math.round(e*m),u=c+Math.round(e*l);n<0?n=0:n>=s&&(n=s-1),u<0?u=0:u>=i&&(u=i-1),v=u*s+n}e[w]=t[v]}u+=s}}},Grayscale:class extends t{#g=0;constructor(t,e=1){super(t),this.#g=e}effect(t,e,s,i,n=1){this.#f(t,e,s,i,this.#g*n)}#f(t,e,s,i,n){const a=1-n;for(let c=0;c<i;++c)for(let i=0;i<s;++i){const r=c*s+i,d=t[r],o=255&d,h=d>>8&255,f=d>>16&255,u=(.2126*o+.7152*h+.0722*f)*n;e[r]=o*a+u|h*a+u<<8|f*a+u<<16|255<<24}}}});let s=!1;const i={force:0,radius:0,weight:0,duration:0,cycle:0,amplitude:0,offset:0};addEventListener("load",(()=>{const t=t=>{const e=Number(document.getElementById(t).value);i[t]=e,document.getElementById(`now:${t}`).textContent=e};s=document.getElementById("auto").checked,t("force"),t("radius"),t("weight"),t("duration"),t("cycle"),t("amplitude"),t("offset");const n=document.getElementById("canvas"),a=document.getElementById("image"),c=new e.Manager(n),r=new Image;r.src=a.value,r.addEventListener("load",(()=>{n.width=r.width,n.height=r.height,c.updateSize()}),!1),a.addEventListener("change",(t=>r.src=t.currentTarget.value)),n.addEventListener("mousedown",(t=>{const s=(t=t||window.event).offsetX||t.layerX-t.target.offsetLeft||0,a=t.offsetY||t.layerY-t.target.offsetTop||0;let r=i.radius;r=r?n.clientWidth>=n.clientHeight?n.clientWidth*r:n.clientHeight*r:void 0,c.add(new e.Impact(s,a,i.force,r,i.weight,i.duration,i.cycle,i.amplitude,i.offset))})),c.add(new e.Grayscale(void 0,1));const d=document.getElementById("fps");let o,h,f=0,u=0;const l=t=>{if(!r||!r.complete)return void setTimeout((()=>requestAnimationFrame(l)),500);void 0===o&&(o=t),f+=1e3/(t-o),++u,o=t,void 0===h&&(h=t);let a=t-h>=1e3;a&&(h=t),a&&(d.textContent=`${n.width}x${n.height}: ${(f/u*1e3|0)/1e3} fps`,f=0,u=0,s&&c.add(new e.Wave(Math.random()*n.clientWidth,Math.random()*n.clientHeight,i.duration,i.cycle,i.amplitude,i.offset))),n.getContext("2d").drawImage(r,0,0,n.clientWidth,n.clientHeight),c.step(t),requestAnimationFrame(l)};requestAnimationFrame(l)})),document.getElementById("auto").addEventListener("click",(function(t){s=this.checked}));const n=t=>{if(!i||!t.currentTarget)return;const e=Number(t.currentTarget.value),s=t.currentTarget.id;i[s]=e,document.getElementById(`now:${s}`).textContent=e};document.getElementById("force").addEventListener("change",n),document.getElementById("radius").addEventListener("change",n),document.getElementById("weight").addEventListener("change",n),document.getElementById("duration").addEventListener("change",n),document.getElementById("cycle").addEventListener("change",n),document.getElementById("amplitude").addEventListener("change",n),document.getElementById("offset").addEventListener("change",n)})();
//# sourceMappingURL=main.js.map