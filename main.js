(()=>{"use strict";class t{#t=0;#e=0;#a=0;constructor(t){this.#t=this.#e=t}get alive(){return void 0===this.#t||this.#t>0}step(t,e,a,n,s){if(void 0===this.#t)this.effect(e,a,n,s);else{if(this.#t<=0)return;this.#a||(this.#a=t),this.effect(e,a,n,s,this.#t/this.#e),this.#t-=t-this.#a,this.#a=t}}effect(t,e,a,n,s=1){}}const e=Object.freeze({Manager:class{#n=null;#s=null;#i=[];constructor(t){if(this.#n=t,!this.#n.getContext)throw new Error("Not support the canvas element.");this.#s=new ImageData(t.width,t.height)}updateSize(){this.#s=new ImageData(this.#n.width,this.#n.height)}add(t){this.#i.push(t)}step(t){if(!this.#i.length)return;const e=this.#n.width,a=this.#n.height,n=this.#n.getContext("2d"),s=n.getImageData(0,0,e,a),i=new Uint32Array(s.data.buffer),r=new Uint32Array(this.#s.data.buffer);for(let n=0;n<this.#i.length;++n)n>0&&i.set(r),this.#i[n].step(t,i,r,e,a);this.#i=this.#i.filter((t=>t.alive)),n.putImageData(this.#s,0,0)}},Wave:class extends t{#r=0;#d=0;#o=0;#c=0;#h=0;constructor(t,e,a=1e3,n=16,s=2048,i=4){super(a),this.#r=t,this.#d=e,this.#o=n,this.#c=s,this.#h=i}effect(t,e,a,n,s=1){this.#f(t,e,a,n,this.#r,this.#d,this.#o,s*this.#c,s*this.#h)}#f(t,e,a,n,s,i,r,d,o){const c=r/Math.sqrt(a*a+n*n)*Math.PI*2;o*=2*Math.PI;for(let r=0;r<n;++r){const h=i-r;for(let i=0;i<a;++i){const f=s-i,u=f*f+h*h,l=r*a+i;if(u){const s=Math.sin(Math.sqrt(u)*c+o)*d/u;let m=i+Math.round(s*f),g=r+Math.round(s*h);m<0?m=0:m>=a&&(m=a-1),g<0?g=0:g>=n&&(g=n-1),e[l]=t[g*a+m]}else e[l]=t[l]}}}},Grayscale:class extends t{#u=0;constructor(t,e=1){super(t),this.#u=e}effect(t,e,a,n,s=1){this.#f(t,e,a,n,this.#u*s)}#f(t,e,a,n,s){const i=1-s;for(let r=0;r<n;++r)for(let n=0;n<a;++n){const d=r*a+n,o=t[d],c=255&o,h=o>>8&255,f=o>>16&255,u=(.2126*c+.7152*h+.0722*f)*s;e[d]=c*i+u|h*i+u<<8|f*i+u<<16|255<<24}}}});let a=!1;const n={duration:0,cycle:0,amplitude:0,offset:0};addEventListener("load",(()=>{const t=t=>{const e=0|document.getElementById(t).value;n[t]=e,document.getElementById(`now:${t}`).textContent=e};a=document.getElementById("auto").checked,t("duration"),t("cycle"),t("amplitude"),t("offset");const s=document.getElementById("canvas"),i=document.getElementById("image"),r=new e.Manager(s),d=new Image;d.src=i.value,d.addEventListener("load",(()=>{s.width=d.width,s.height=d.height,r.updateSize()}),!1),i.addEventListener("change",(t=>d.src=t.currentTarget.value)),s.addEventListener("mousedown",(t=>{const a=(t=t||window.event).offsetX||t.layerX-t.target.offsetLeft||0,s=t.offsetY||t.layerY-t.target.offsetTop||0;r.add(new e.Wave(a,s,n.duration,n.cycle,n.amplitude,n.offset))})),r.add(new e.Grayscale(void 0,1));const o=document.getElementById("fps");let c,h,f=0,u=0;const l=t=>{if(!d||!d.complete)return void setTimeout((()=>requestAnimationFrame(l)),500);void 0===c&&(c=t),f+=1e3/(t-c),++u,c=t,void 0===h&&(h=t);let i=t-h>=1e3;i&&(h=t),i&&(o.textContent=`${s.width}x${s.height}: ${(f/u*1e3|0)/1e3} fps`,f=0,u=0,a&&r.add(new e.Wave(Math.random()*s.clientWidth,Math.random()*s.clientHeight,n.duration,n.cycle,n.amplitude,n.offset))),s.getContext("2d").drawImage(d,0,0,s.clientWidth,s.clientHeight),r.step(t),requestAnimationFrame(l)};requestAnimationFrame(l)})),document.getElementById("auto").addEventListener("click",(function(t){a=this.checked}));const s=t=>{if(!n||!t.currentTarget)return;const e=0|t.currentTarget.value,a=t.currentTarget.id;n[a]=e,document.getElementById(`now:${a}`).textContent=e};document.getElementById("duration").addEventListener("change",s),document.getElementById("cycle").addEventListener("change",s),document.getElementById("amplitude").addEventListener("change",s),document.getElementById("offset").addEventListener("change",s)})();
//# sourceMappingURL=main.js.map