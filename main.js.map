{"version":3,"file":"main.js","mappings":"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","sources":["webpack://canvas-effect-demo/./src/effect/animated-core.js","webpack://canvas-effect-demo/./src/effect/index.js","webpack://canvas-effect-demo/./src/effect/manager.js","webpack://canvas-effect-demo/./src/effect/wave.js","webpack://canvas-effect-demo/./src/effect/impact.js","webpack://canvas-effect-demo/./src/effect/grayscale.js","webpack://canvas-effect-demo/./src/main.js"],"sourcesContent":["export default class AnimatedCore {\n\t#duration = 0;\n\t#maxDuration = 0;\n\t#lastTime = 0;\n\n\tconstructor(duration = undefined) { this.#duration = this.#maxDuration = duration; }\n\n\tget alive() { return this.#duration === undefined || this.#duration > 0; }\n\n\tstep(tick, src, dst, w, h) {\n\t\tif (this.#duration === undefined)\n\t\t\tthis.effect(src, dst, w, h);\n\t\telse {\n\t\t\tif (this.#duration <= 0) return;\n\t\t\tif (!this.#lastTime) this.#lastTime = tick;\n\t\t\tthis.effect(src, dst, w, h, this.#duration / this.#maxDuration);\n\t\t\tthis.#duration -= tick - this.#lastTime;\n\t\t\tthis.#lastTime = tick;\n\t\t}\n\t}\n\n\teffect(src, dst, w, h, level = 1) { }\n}\n","import Manager from \"./manager.js\";\nimport Wave from \"./wave.js\";\nimport Impact from \"./impact.js\";\nimport Grayscale from \"./grayscale.js\";\n\nexport default Object.freeze({ Manager, Wave, Impact, Grayscale });","export default class Manager {\n\t#drawCanvas = null;\n\t#workBuffer = null;\n\t#effects = [];\n\n\tconstructor(canvas) {\n\t\tthis.#drawCanvas = canvas;\n\t\tif (!this.#drawCanvas.getContext)\n\t\t\tthrow new Error(\"Not support the canvas element.\");\n\t\tthis.#workBuffer = new ImageData(canvas.width, canvas.height);\n\t}\n\n\tupdateSize() { this.#workBuffer = new ImageData(this.#drawCanvas.width, this.#drawCanvas.height); }\n\n\tadd(effect) { this.#effects.push(effect); }\n\n\tstep(tick) {\n\t\tif (!this.#effects.length) return;\n\n\t\tconst w = this.#drawCanvas.width;\n\t\tconst h = this.#drawCanvas.height;\n\n\t\tconst ctx = this.#drawCanvas.getContext(\"2d\");\n\t\tconst imageDataSrc = ctx.getImageData(0, 0, w, h);\n\t\tconst src = new Uint32Array(imageDataSrc.data.buffer);\n\t\tconst dst = new Uint32Array(this.#workBuffer.data.buffer);\n\n\t\tfor (let i = 0; i < this.#effects.length; ++i) {\n\t\t\tif (i > 0) src.set(dst);\n\t\t\tthis.#effects[i].step(tick, src, dst, w, h);\n\t\t}\n\n\t\tthis.#effects = this.#effects.filter(e => e.alive);\n\n\t\tctx.putImageData(this.#workBuffer, 0, 0);\n\t}\n}\n","import AnimatedCore from \"./animated-core.js\";\n\nexport default class Wave extends AnimatedCore {\n\t#cx = 0;\n\t#cy = 0;\n\t#cycle = 0;\n\t#amplitude = 0;\n\t#offset = 0;\n\n\tconstructor(cx, cy, duration = 1000, cycle = 16, amplitude = 2048, offset = 4) {\n\t\tsuper(duration);\n\t\tthis.#cx = cx;\n\t\tthis.#cy = cy;\n\t\tthis.#cycle = cycle;\n\t\tthis.#amplitude = amplitude;\n\t\tthis.#offset = offset;\n\t}\n\n\teffect(src, dst, w, h, level = 1) {\n\t\tthis.#effect(src, dst, w, h, this.#cx, this.#cy, this.#cycle, level * this.#amplitude, level * this.#offset);\n\t}\n\n\t#effect(src, dst, w, h, cx, cy, cycle, amplitude, offset) {\n\t\tconst c = cycle / Math.sqrt(w * w + h * h) * Math.PI * 2;\n\t\tlet dstIndex = 0;\n\t\toffset *= Math.PI * 2;\n\t\tfor (let y = 0; y < h; ++y) {\n\t\t\tconst dy = cy - y;\n\t\t\tfor (let x = 0; x < w; ++x) {\n\t\t\t\tconst dx = cx - x;\n\t\t\t\tconst r = dx * dx + dy * dy\n\t\t\t\tconst dstOffset = dstIndex + x;\n\t\t\t\tif (r) {\n\t\t\t\t\tconst d = Math.sin(Math.sqrt(r) * c + offset) * amplitude / r;\n\t\t\t\t\tlet sx = x + Math.round(d * dx);\n\t\t\t\t\tlet sy = y + Math.round(d * dy);\n\t\t\t\t\tif (sx < 0) sx = 0; else if (sx >= w) sx = w - 1;\n\t\t\t\t\tif (sy < 0) sy = 0; else if (sy >= h) sy = h - 1;\n\t\t\t\t\tdst[dstOffset] = src[sy * w + sx];\n\t\t\t\t} else\n\t\t\t\t\tdst[dstOffset] = src[dstOffset];\n\t\t\t}\n\t\t\tdstIndex += w;\n\t\t}\n\t}\n}\n","import AnimatedCore from \"./animated-core.js\";\n\nexport default class Impact extends AnimatedCore {\n\t#cx = 0;\n\t#cy = 0;\n\t#force = 0;\n\t#weight = 0;\n\t#radius = undefined;\n\t#cycle = 0;\n\t#amplitude = 0;\n\t#offset = 0;\n\n\tconstructor(cx, cy, force = 5, radius = undefined, weight = 2, duration = 1000, cycle = 16, amplitude = 2048, offset = 4) {\n\t\tsuper(duration);\n\t\tthis.#cx = cx;\n\t\tthis.#cy = cy;\n\t\tthis.#force = force;\n\t\tthis.#radius = radius;\n\t\tthis.#weight = weight;\n\t\tthis.#cycle = cycle;\n\t\tthis.#amplitude = amplitude;\n\t\tthis.#offset = offset;\n\t}\n\n\teffect(src, dst, w, h, level = 1) {\n\t\tlet radius = this.#radius;\n\t\tif (radius === undefined)\n\t\t\tradius = Math.sqrt((w >> 1) ** 2 + (h >> 1) ** 2);\n\t\tconst force = level ** this.#force;\n\t\tradius *= 1 - force;\n\t\tthis.#effect(src, dst, w, h, this.#cx, this.#cy, this.#cycle, this.#amplitude, this.#offset, radius, force * this.#weight);\n\t}\n\n\t#effect(src, dst, w, h, cx, cy, cycle, amplitude, offset, radius, weight) {\n\t\tconst c = cycle / Math.sqrt(w * w + h * h) * Math.PI * 2;\n\t\tlet dstIndex = 0;\n\t\toffset *= Math.PI * 2;\n\t\tfor (let y = 0; y < h; ++y) {\n\t\t\tconst dy = cy - y;\n\t\t\tfor (let x = 0; x < w; ++x) {\n\t\t\t\tconst dx = cx - x;\n\t\t\t\tconst r = dx * dx + dy * dy\n\t\t\t\tconst dstOffset = dstIndex + x;\n\t\t\t\tlet srcOffset = dstOffset;\n\t\t\t\tif (r) {\n\t\t\t\t\tconst distance = Math.sqrt(r);\n\t\t\t\t\tif (distance < radius - weight || distance > radius + weight)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tconst depth = Math.sin(distance * c + offset);\n\t\t\t\t\tconst d = depth * amplitude / r;\n\t\t\t\t\tlet sx = x + Math.round(d * dx);\n\t\t\t\t\tlet sy = y + Math.round(d * dy);\n\t\t\t\t\tif (sx < 0) sx = 0; else if (sx >= w) sx = w - 1;\n\t\t\t\t\tif (sy < 0) sy = 0; else if (sy >= h) sy = h - 1;\n\t\t\t\t\tsrcOffset = sy * w + sx;\n\t\t\t\t}\n\t\t\t\tdst[dstOffset] = src[srcOffset];\n\t\t\t}\n\t\t\tdstIndex += w;\n\t\t}\n\t}\n}\n","import AnimatedCore from \"./animated-core.js\";\n\nexport default class Grayscale extends AnimatedCore {\n\t#alpha = 0;\n\n\tconstructor(duration = undefined, alpha = 1) {\n\t\tsuper(duration);\n\t\tthis.#alpha = alpha;\n\t}\n\n\teffect(src, dst, w, h, level = 1) {\n\t\tthis.#effect(src, dst, w, h, this.#alpha * level);\n\t}\n\n\t#effect(src, dst, w, h, alpha) {\n\t\tconst ralpha = 1 - alpha;\n\t\tfor (let y = 0; y < h; ++y) {\n\t\t\tfor (let x = 0; x < w; ++x) {\n\t\t\t\tconst doffset = y * w + x;\n\t\t\t\tconst color = src[doffset];\n\t\t\t\tconst r = color & 0xff;\n\t\t\t\tconst g = (color >> 8) & 0xff;\n\t\t\t\tconst b = (color >> 16) & 0xff;\n\t\t\t\tconst lu = (0.2126 * r + 0.7152 * g + 0.0722 * b) * alpha;\n\t\t\t\tdst[doffset] = (r * ralpha + lu) | ((g * ralpha + lu) << 8) | ((b * ralpha + lu) << 16) | 0xff << 24;\n\t\t\t}\n\t\t}\n\t}\n}\n","import Effect from \"./effect\";\n\nlet auto = false;\n\nconst params = {\n\tforce: 0,\n\tradius: 0,\n\tweight: 0,\n\tduration: 0,\n\tcycle: 0,\n\tamplitude: 0,\n\toffset: 0,\n};\n\naddEventListener(\"load\", () => {\n\tconst getDefaultParam = id => {\n\t\tconst value = Number(document.getElementById(id).value);\n\t\tparams[id] = value;\n\t\tdocument.getElementById(`now:${id}`).textContent = value;\n\t};\n\n\tauto = document.getElementById(\"auto\").checked;\n\tgetDefaultParam(\"force\");\n\tgetDefaultParam(\"radius\");\n\tgetDefaultParam(\"weight\");\n\tgetDefaultParam(\"duration\");\n\tgetDefaultParam(\"cycle\");\n\tgetDefaultParam(\"amplitude\");\n\tgetDefaultParam(\"offset\");\n\n\tconst canvas = document.getElementById(\"canvas\");\n\tconst image = document.getElementById(\"image\");\n\tconst effect = new Effect.Manager(canvas);\n\tconst bgImage = new Image;\n\tbgImage.src = image.value;\n\tbgImage.addEventListener(\"load\", () => {\n\t\tcanvas.width = bgImage.width;\n\t\tcanvas.height = bgImage.height;\n\t\teffect.updateSize();\n\t}, false);\n\timage.addEventListener(\"change\", e => bgImage.src = e.currentTarget.value);\n\tcanvas.addEventListener(\"mousedown\", e => {\n\t\te = e || window.event;\n\t\tconst cx = e.offsetX || e.layerX - e.target.offsetLeft || 0;\n\t\tconst cy = e.offsetY || e.layerY - e.target.offsetTop || 0;\n\t\tlet radius = params.radius;\n\t\tif (!radius)\n\t\t\tradius = undefined;\n\t\telse if (canvas.clientWidth >= canvas.clientHeight)\n\t\t\tradius = canvas.clientWidth * radius;\n\t\telse\n\t\t\tradius = canvas.clientHeight * radius;\n\t\teffect.add(new Effect.Impact(cx, cy, params.force, radius, params.weight, params.duration, params.cycle, params.amplitude, params.offset));\n\t});\n\n\teffect.add(new Effect.Grayscale(undefined, 1));\n\n\tconst fps = document.getElementById(\"fps\");\n\tlet lastTick = undefined;\n\tlet lastMinuts = undefined;\n\tlet totalFPS = 0;\n\tlet frameCount = 0;\n\tconst draw = tick => {\n\t\tif (!bgImage || !bgImage.complete) {\n\t\t\tsetTimeout(() => requestAnimationFrame(draw), 500);\n\t\t\treturn;\n\t\t}\n\n\t\tif (lastTick === undefined) lastTick = tick;\n\t\ttotalFPS += 1000 / (tick - lastTick);\n\t\t++frameCount;\n\t\tlastTick = tick;\n\n\t\tif (lastMinuts === undefined) lastMinuts = tick;\n\t\tlet minits = (tick - lastMinuts) >= 1000;\n\t\tif (minits) lastMinuts = tick;\n\n\t\tif (minits) {\n\t\t\tfps.textContent = `${canvas.width}x${canvas.height}: ${((totalFPS / frameCount) * 1000 | 0) / 1000} fps`;\n\t\t\ttotalFPS = 0;\n\t\t\tframeCount = 0;\n\t\t\tif (auto)\n\t\t\t\teffect.add(new Effect.Wave(Math.random() * canvas.clientWidth, Math.random() * canvas.clientHeight, params.duration, params.cycle, params.amplitude, params.offset));\n\t\t}\n\n\t\tconst ctx = canvas.getContext(\"2d\");\n\t\tctx.drawImage(bgImage, 0, 0, canvas.clientWidth, canvas.clientHeight);\n\t\teffect.step(tick);\n\t\trequestAnimationFrame(draw);\n\t};\n\trequestAnimationFrame(draw);\n});\n\ndocument.getElementById(\"auto\").addEventListener(\"click\", function (e) { auto = this.checked });\n\nconst setParam = e => {\n\tif (!params || !e.currentTarget) return;\n\tconst value = Number(e.currentTarget.value);\n\tconst id = e.currentTarget.id;\n\tparams[id] = value;\n\tdocument.getElementById(`now:${id}`).textContent = value;\n};\n\ndocument.getElementById(\"force\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"radius\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"weight\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"duration\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"cycle\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"amplitude\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"offset\").addEventListener(\"change\", setParam);"],"names":["AnimatedCore","constructor","duration","this","alive","undefined","step","tick","src","dst","w","h","effect","level","Object","freeze","Manager","canvas","getContext","Error","ImageData","width","height","updateSize","add","push","length","ctx","imageDataSrc","getImageData","Uint32Array","data","buffer","i","set","filter","e","putImageData","cx","cy","cycle","amplitude","offset","super","c","Math","sqrt","PI","dstIndex","y","dy","x","dx","r","dstOffset","d","sin","sx","round","sy","force","radius","weight","srcOffset","distance","alpha","ralpha","doffset","color","g","b","lu","auto","params","addEventListener","getDefaultParam","id","value","Number","document","getElementById","textContent","checked","image","bgImage","Image","currentTarget","window","event","offsetX","layerX","target","offsetLeft","offsetY","layerY","offsetTop","clientWidth","clientHeight","fps","lastTick","lastMinuts","totalFPS","frameCount","draw","complete","setTimeout","requestAnimationFrame","minits","random","drawImage","setParam"],"sourceRoot":""}