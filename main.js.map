{"version":3,"file":"main.js","mappings":"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","sources":["webpack://canvas-effect-demo/./src/effect/animated-core.js","webpack://canvas-effect-demo/./src/effect/index.js","webpack://canvas-effect-demo/./src/effect/manager.js","webpack://canvas-effect-demo/./src/effect/wave.js","webpack://canvas-effect-demo/./src/effect/grayscale.js","webpack://canvas-effect-demo/./src/main.js"],"sourcesContent":["export default class AnimatedCore {\n\t#duration = 0;\n\t#maxDuration = 0;\n\t#lastTime = 0;\n\n\tconstructor(duration = undefined) { this.#duration = this.#maxDuration = duration; }\n\n\tget alive() { return this.#duration === undefined || this.#duration > 0; }\n\n\tstep(tick, src, dst, w, h) {\n\t\tif (this.#duration === undefined)\n\t\t\tthis.effect(src, dst, w, h);\n\t\telse {\n\t\t\tif (this.#duration <= 0) return;\n\t\t\tif (!this.#lastTime) this.#lastTime = tick;\n\t\t\tthis.effect(src, dst, w, h, this.#duration / this.#maxDuration);\n\t\t\tthis.#duration -= tick - this.#lastTime;\n\t\t\tthis.#lastTime = tick;\n\t\t}\n\t}\n\n\teffect(src, dst, w, h, level = 1) { }\n}\n","import Manager from \"./manager.js\";\nimport Wave from \"./wave.js\";\nimport Grayscale from \"./grayscale.js\";\n\nexport default Object.freeze({ Manager, Wave, Grayscale });","export default class Manager {\n\t#drawCanvas = null;\n\t#workBuffer = null;\n\t#effects = [];\n\n\tconstructor(canvas) {\n\t\tthis.#drawCanvas = canvas;\n\t\tif (!this.#drawCanvas.getContext)\n\t\t\tthrow new Error(\"Not support the canvas element.\");\n\t\tthis.#workBuffer = new ImageData(canvas.width, canvas.height);\n\t}\n\n\tupdateSize() { this.#workBuffer = new ImageData(this.#drawCanvas.width, this.#drawCanvas.height); }\n\n\tadd(effect) { this.#effects.push(effect); }\n\n\tstep(tick) {\n\t\tif (!this.#effects.length) return;\n\n\t\tconst w = this.#drawCanvas.width;\n\t\tconst h = this.#drawCanvas.height;\n\n\t\tconst ctx = this.#drawCanvas.getContext(\"2d\");\n\t\tconst imageDataSrc = ctx.getImageData(0, 0, w, h);\n\t\tconst src = new Uint32Array(imageDataSrc.data.buffer);\n\t\tconst dst = new Uint32Array(this.#workBuffer.data.buffer);\n\n\t\tfor (let i = 0; i < this.#effects.length; ++i) {\n\t\t\tif (i > 0) src.set(dst);\n\t\t\tthis.#effects[i].step(tick, src, dst, w, h);\n\t\t}\n\n\t\tthis.#effects = this.#effects.filter(e => e.alive);\n\n\t\tctx.putImageData(this.#workBuffer, 0, 0);\n\t}\n}\n","import AnimatedCore from \"./animated-core.js\";\n\nexport default class Wave extends AnimatedCore {\n\t#cx = 0;\n\t#cy = 0;\n\t#cycle = 0;\n\t#amplitude = 0;\n\t#offset = 0;\n\n\tconstructor(cx, cy, duration = 1000, cycle = 16, amplitude = 2048, offset = 4) {\n\t\tsuper(duration);\n\t\tthis.#cx = cx;\n\t\tthis.#cy = cy;\n\t\tthis.#cycle = cycle;\n\t\tthis.#amplitude = amplitude;\n\t\tthis.#offset = offset;\n\t}\n\n\teffect(src, dst, w, h, level = 1) {\n\t\tthis.#effect(src, dst, w, h, this.#cx, this.#cy, this.#cycle, level * this.#amplitude, level * this.#offset);\n\t}\n\n\t#effect(src, dst, w, h, cx, cy, cycle, amplitude, offset) {\n\t\tconst c = cycle / Math.sqrt(w * w + h * h) * Math.PI * 2;\n\t\toffset *= Math.PI * 2;\n\t\tfor (let y = 0; y < h; ++y) {\n\t\t\tconst dy = cy - y;\n\t\t\tfor (let x = 0; x < w; ++x) {\n\t\t\t\tconst dx = cx - x;\n\t\t\t\tconst r = dx * dx + dy * dy\n\t\t\t\tconst doffset = y * w + x;\n\t\t\t\tif (r) {\n\t\t\t\t\tconst d = Math.sin(Math.sqrt(r) * c + offset) * amplitude / r;\n\t\t\t\t\tlet sx = x + Math.round(d * dx);\n\t\t\t\t\tlet sy = y + Math.round(d * dy);\n\t\t\t\t\tif (sx < 0) sx = 0;\n\t\t\t\t\telse if (sx >= w) sx = w - 1;\n\t\t\t\t\tif (sy < 0) sy = 0;\n\t\t\t\t\telse if (sy >= h) sy = h - 1;\n\t\t\t\t\tdst[doffset] = src[sy * w + sx];\n\t\t\t\t} else\n\t\t\t\t\tdst[doffset] = src[doffset];\n\t\t\t}\n\t\t}\n\t}\n}\n","import AnimatedCore from \"./animated-core.js\";\n\nexport default class Grayscale extends AnimatedCore {\n\t#alpha = 0;\n\n\tconstructor(duration = undefined, alpha = 1) {\n\t\tsuper(duration);\n\t\tthis.#alpha = alpha;\n\t}\n\n\teffect(src, dst, w, h, level = 1) {\n\t\tthis.#effect(src, dst, w, h, this.#alpha * level);\n\t}\n\n\t#effect(src, dst, w, h, alpha) {\n\t\tconst ralpha = 1 - alpha;\n\t\tfor (let y = 0; y < h; ++y) {\n\t\t\tfor (let x = 0; x < w; ++x) {\n\t\t\t\tconst doffset = y * w + x;\n\t\t\t\tconst color = src[doffset];\n\t\t\t\tconst r = color & 0xff;\n\t\t\t\tconst g = (color >> 8) & 0xff;\n\t\t\t\tconst b = (color >> 16) & 0xff;\n\t\t\t\tconst lu = (0.2126 * r + 0.7152 * g + 0.0722 * b) * alpha;\n\t\t\t\tdst[doffset] = (r * ralpha + lu) | ((g * ralpha + lu) << 8) | ((b * ralpha + lu) << 16) | 0xff << 24;\n\t\t\t}\n\t\t}\n\t}\n}\n","import Effect from \"./effect\";\n\nlet auto = false;\n\nconst params = {\n\tduration: 0,\n\tcycle: 0,\n\tamplitude: 0,\n\toffset: 0,\n};\n\naddEventListener(\"load\", () => {\n\tconst getDefaultParam = id => {\n\t\tconst value = document.getElementById(id).value | 0;\n\t\tparams[id] = value;\n\t\tdocument.getElementById(`now:${id}`).textContent = value;\n\t};\n\n\tauto = document.getElementById(\"auto\").checked;\n\tgetDefaultParam(\"duration\");\n\tgetDefaultParam(\"cycle\");\n\tgetDefaultParam(\"amplitude\");\n\tgetDefaultParam(\"offset\");\n\n\tconst canvas = document.getElementById(\"canvas\");\n\tconst image = document.getElementById(\"image\");\n\tconst effect = new Effect.Manager(canvas);\n\tconst bgImage = new Image;\n\tbgImage.src = image.value;\n\tbgImage.addEventListener(\"load\", () => {\n\t\tcanvas.width = bgImage.width;\n\t\tcanvas.height = bgImage.height;\n\t\teffect.updateSize();\n\t}, false);\n\timage.addEventListener(\"change\", e => bgImage.src = e.currentTarget.value);\n\tcanvas.addEventListener(\"mousedown\", e => {\n\t\te = e || window.event;\n\t\tconst cx = e.offsetX || e.layerX - e.target.offsetLeft || 0;\n\t\tconst cy = e.offsetY || e.layerY - e.target.offsetTop || 0;\n\t\teffect.add(new Effect.Wave(cx, cy, params.duration, params.cycle, params.amplitude, params.offset));\n\t});\n\n\teffect.add(new Effect.Grayscale(undefined, 1));\n\n\tconst fps = document.getElementById(\"fps\");\n\tlet lastTick = undefined;\n\tlet lastMinuts = undefined;\n\tlet totalFPS = 0;\n\tlet frameCount = 0;\n\tconst draw = tick => {\n\t\tif (!bgImage || !bgImage.complete) {\n\t\t\tsetTimeout(() => requestAnimationFrame(draw), 500);\n\t\t\treturn;\n\t\t}\n\n\t\tif (lastTick === undefined) lastTick = tick;\n\t\ttotalFPS += 1000 / (tick - lastTick);\n\t\t++frameCount;\n\t\tlastTick = tick;\n\n\t\tif (lastMinuts === undefined) lastMinuts = tick;\n\t\tlet minits = (tick - lastMinuts) >= 1000;\n\t\tif (minits) lastMinuts = tick;\n\n\t\tif (minits) {\n\t\t\tfps.textContent = `${canvas.width}x${canvas.height}: ${((totalFPS / frameCount) * 1000 | 0) / 1000} fps`;\n\t\t\ttotalFPS = 0;\n\t\t\tframeCount = 0;\n\t\t\tif (auto)\n\t\t\t\teffect.add(new Effect.Wave(Math.random() * canvas.clientWidth, Math.random() * canvas.clientHeight, params.duration, params.cycle, params.amplitude, params.offset));\n\t\t}\n\n\t\tconst ctx = canvas.getContext(\"2d\");\n\t\tctx.drawImage(bgImage, 0, 0, canvas.clientWidth, canvas.clientHeight);\n\t\teffect.step(tick);\n\t\trequestAnimationFrame(draw);\n\t};\n\trequestAnimationFrame(draw);\n});\n\ndocument.getElementById(\"auto\").addEventListener(\"click\", function (e) { auto = this.checked });\n\nconst setParam = e => {\n\tif (!params || !e.currentTarget) return;\n\tconst value = e.currentTarget.value | 0;\n\tconst id = e.currentTarget.id;\n\tparams[id] = value;\n\tdocument.getElementById(`now:${id}`).textContent = value;\n};\n\ndocument.getElementById(\"duration\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"cycle\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"amplitude\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"offset\").addEventListener(\"change\", setParam);"],"names":["AnimatedCore","constructor","duration","this","alive","undefined","step","tick","src","dst","w","h","effect","level","Object","freeze","Manager","canvas","getContext","Error","ImageData","width","height","updateSize","add","push","length","ctx","imageDataSrc","getImageData","Uint32Array","data","buffer","i","set","filter","e","putImageData","cx","cy","cycle","amplitude","offset","super","c","Math","sqrt","PI","y","dy","x","dx","r","doffset","d","sin","sx","round","sy","alpha","ralpha","color","g","b","lu","auto","params","addEventListener","getDefaultParam","id","value","document","getElementById","textContent","checked","image","bgImage","Image","currentTarget","window","event","offsetX","layerX","target","offsetLeft","offsetY","layerY","offsetTop","fps","lastTick","lastMinuts","totalFPS","frameCount","draw","complete","setTimeout","requestAnimationFrame","minits","random","clientWidth","clientHeight","drawImage","setParam"],"sourceRoot":""}