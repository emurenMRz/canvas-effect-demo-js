{"version":3,"file":"main.js","mappings":"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","sources":["webpack://canvas-effect-demo/./src/effect/animated-core.js","webpack://canvas-effect-demo/./src/effect/index.js","webpack://canvas-effect-demo/./src/effect/manager.js","webpack://canvas-effect-demo/./src/effect/wave.js","webpack://canvas-effect-demo/./src/effect/impact.js","webpack://canvas-effect-demo/./src/effect/perlin-noise.js","webpack://canvas-effect-demo/./src/effect/grayscale.js","webpack://canvas-effect-demo/./src/main.js"],"sourcesContent":["export default class AnimatedCore {\n\t#duration = 0;\n\t#maxDuration = 0;\n\t#lastTime = 0;\n\n\tconstructor(duration = undefined) { this.#duration = this.#maxDuration = duration; }\n\n\tget alive() { return this.#duration === undefined || this.#duration > 0; }\n\n\tstep(tick, src, dst, w, h) {\n\t\tif (this.#duration === undefined)\n\t\t\tthis.effect(src, dst, w, h);\n\t\telse {\n\t\t\tif (this.#duration <= 0) return;\n\t\t\tif (!this.#lastTime) this.#lastTime = tick;\n\t\t\tthis.effect(src, dst, w, h, this.#duration / this.#maxDuration);\n\t\t\tthis.#duration -= tick - this.#lastTime;\n\t\t\tthis.#lastTime = tick;\n\t\t}\n\t}\n\n\teffect(src, dst, w, h, level = 1) { }\n}\n","import Manager from \"./manager.js\";\nimport Wave from \"./wave.js\";\nimport Impact from \"./impact.js\";\nimport PerlinNoise from \"./perlin-noise.js\";\nimport Grayscale from \"./grayscale.js\";\n\nexport default Object.freeze({ Manager, Wave, Impact, PerlinNoise, Grayscale });","export default class Manager {\n\t#drawCanvas = null;\n\t#workBuffer = null;\n\t#effects = [];\n\n\tconstructor(canvas) {\n\t\tthis.#drawCanvas = canvas;\n\t\tif (!this.#drawCanvas.getContext)\n\t\t\tthrow new Error(\"Not support the canvas element.\");\n\t\tthis.#workBuffer = new ImageData(canvas.width, canvas.height);\n\t}\n\n\tupdateSize() { this.#workBuffer = new ImageData(this.#drawCanvas.width, this.#drawCanvas.height); }\n\n\tadd(effect) { this.#effects.push(effect); }\n\n\tstep(tick) {\n\t\tif (!this.#effects.length) return;\n\n\t\tconst w = this.#drawCanvas.width;\n\t\tconst h = this.#drawCanvas.height;\n\n\t\tconst ctx = this.#drawCanvas.getContext(\"2d\");\n\t\tconst imageDataSrc = ctx.getImageData(0, 0, w, h);\n\t\tconst src = new Uint32Array(imageDataSrc.data.buffer);\n\t\tconst dst = new Uint32Array(this.#workBuffer.data.buffer);\n\n\t\tfor (let i = 0; i < this.#effects.length; ++i) {\n\t\t\tif (i > 0) src.set(dst);\n\t\t\tthis.#effects[i].step(tick, src, dst, w, h);\n\t\t}\n\n\t\tthis.#effects = this.#effects.filter(e => e.alive);\n\n\t\tctx.putImageData(this.#workBuffer, 0, 0);\n\t}\n}\n","import AnimatedCore from \"./animated-core.js\";\n\nexport default class Wave extends AnimatedCore {\n\t#cx = 0;\n\t#cy = 0;\n\t#cycle = 0;\n\t#amplitude = 0;\n\t#offset = 0;\n\n\tconstructor(cx, cy, duration = 1000, cycle = 16, amplitude = 2048, offset = 4) {\n\t\tsuper(duration);\n\t\tthis.#cx = cx;\n\t\tthis.#cy = cy;\n\t\tthis.#cycle = cycle;\n\t\tthis.#amplitude = amplitude;\n\t\tthis.#offset = offset;\n\t}\n\n\teffect(src, dst, w, h, level = 1) {\n\t\tthis.#effect(src, dst, w, h, this.#cx, this.#cy, this.#cycle, level * this.#amplitude, level * this.#offset);\n\t}\n\n\t#effect(src, dst, w, h, cx, cy, cycle, amplitude, offset) {\n\t\tconst c = cycle / Math.sqrt(w * w + h * h) * Math.PI * 2;\n\t\tlet dstIndex = 0;\n\t\toffset *= Math.PI * 2;\n\t\tfor (let y = 0; y < h; ++y) {\n\t\t\tconst dy = cy - y;\n\t\t\tfor (let x = 0; x < w; ++x) {\n\t\t\t\tconst dx = cx - x;\n\t\t\t\tconst r = dx * dx + dy * dy\n\t\t\t\tconst dstOffset = dstIndex + x;\n\t\t\t\tif (r) {\n\t\t\t\t\tconst d = Math.sin(Math.sqrt(r) * c + offset) * amplitude / r;\n\t\t\t\t\tlet sx = x + Math.round(d * dx);\n\t\t\t\t\tlet sy = y + Math.round(d * dy);\n\t\t\t\t\tif (sx < 0) sx = 0; else if (sx >= w) sx = w - 1;\n\t\t\t\t\tif (sy < 0) sy = 0; else if (sy >= h) sy = h - 1;\n\t\t\t\t\tdst[dstOffset] = src[sy * w + sx];\n\t\t\t\t} else\n\t\t\t\t\tdst[dstOffset] = src[dstOffset];\n\t\t\t}\n\t\t\tdstIndex += w;\n\t\t}\n\t}\n}\n","import AnimatedCore from \"./animated-core.js\";\n\nexport default class Impact extends AnimatedCore {\n\t#cx = 0;\n\t#cy = 0;\n\t#force = 0;\n\t#weight = 0;\n\t#radius = undefined;\n\t#cycle = 0;\n\t#amplitude = 0;\n\t#offset = 0;\n\n\tconstructor(cx, cy, force = 5, radius = undefined, weight = 2, duration = 1000, cycle = 16, amplitude = 2048, offset = 4) {\n\t\tsuper(duration);\n\t\tthis.#cx = cx;\n\t\tthis.#cy = cy;\n\t\tthis.#force = force;\n\t\tthis.#radius = radius;\n\t\tthis.#weight = weight;\n\t\tthis.#cycle = cycle;\n\t\tthis.#amplitude = amplitude;\n\t\tthis.#offset = offset;\n\t}\n\n\teffect(src, dst, w, h, level = 1) {\n\t\tlet radius = this.#radius;\n\t\tif (radius === undefined)\n\t\t\tradius = Math.sqrt((w >> 1) ** 2 + (h >> 1) ** 2);\n\t\tconst force = level ** this.#force;\n\t\tradius *= 1 - force;\n\t\tthis.#effect(src, dst, w, h, this.#cx, this.#cy, this.#cycle, this.#amplitude, this.#offset, radius, force * this.#weight);\n\t}\n\n\t#effect(src, dst, w, h, cx, cy, cycle, amplitude, offset, radius, weight) {\n\t\tconst c = cycle / Math.sqrt(w * w + h * h) * Math.PI * 2;\n\t\tlet dstIndex = 0;\n\t\toffset *= Math.PI * 2;\n\t\tfor (let y = 0; y < h; ++y) {\n\t\t\tconst dy = cy - y;\n\t\t\tfor (let x = 0; x < w; ++x) {\n\t\t\t\tconst dx = cx - x;\n\t\t\t\tconst r = dx * dx + dy * dy\n\t\t\t\tconst dstOffset = dstIndex + x;\n\t\t\t\tlet srcOffset = dstOffset;\n\t\t\t\tif (r) {\n\t\t\t\t\tconst distance = Math.sqrt(r);\n\t\t\t\t\tif (distance < radius - weight || distance > radius + weight)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tconst depth = Math.sin(distance * c + offset);\n\t\t\t\t\tconst d = depth * amplitude / r;\n\t\t\t\t\tlet sx = x + Math.round(d * dx);\n\t\t\t\t\tlet sy = y + Math.round(d * dy);\n\t\t\t\t\tif (sx < 0) sx = 0; else if (sx >= w) sx = w - 1;\n\t\t\t\t\tif (sy < 0) sy = 0; else if (sy >= h) sy = h - 1;\n\t\t\t\t\tsrcOffset = sy * w + sx;\n\t\t\t\t}\n\t\t\t\tdst[dstOffset] = src[srcOffset];\n\t\t\t}\n\t\t\tdstIndex += w;\n\t\t}\n\t}\n}\n","import AnimatedCore from \"./animated-core.js\";\n\nexport default class PerlinNoise extends AnimatedCore {\n\t#alpha = 0;\n\t#permutation = null;\n\n\tconstructor(duration = undefined, alpha = 1) {\n\t\tsuper(duration);\n\t\tthis.#alpha = alpha;\n\t\tthis.#permutation = this.#noiseTable;\n\t}\n\n\teffect(src, dst, w, h, level = 1) {\n\t\tthis.#effect(src, dst, w, h, this.#alpha * level);\n\t}\n\n\t#effect(src, dst, w, h, alpha) {\n\t\tfor (let y = 0; y < h; ++y) {\n\t\t\tfor (let x = 0; x < w; ++x) {\n\t\t\t\tconst doffset = y * w + x;\n\t\t\t\tconst color = src[doffset];\n\t\t\t\tconst r = color & 0xff;\n\t\t\t\tconst g = (color >> 8) & 0xff;\n\t\t\t\tconst b = (color >> 16) & 0xff;\n\t\t\t\tconst noise = this.#octavePerlin(x / w * 4, y / h * 4);\n\t\t\t\tconst n = noise * alpha + 1;\n\t\t\t\tconst rn = r * n > 255 ? 255 : r * n;\n\t\t\t\tconst gn = g * n > 255 ? 255 : g * n;\n\t\t\t\tconst bn = b * n > 255 ? 255 : b * n;\n\t\t\t\tdst[doffset] = rn | (gn << 8) | (bn << 16) | 0xff << 24;\n\t\t\t}\n\t\t}\n\t}\n\n\tget #noiseTable() {\n\t\tconst base = [...Array(256)].map((v, i) => i);\n\t\tfor (const i in base) {\n\t\t\tconst j = Math.random() * base.length | 0;\n\t\t\t[base[i], base[j]] = [base[j], base[i]];\n\t\t}\n\t\treturn base.concat(base);\n\t}\n\n\t#perlin(x, y, z) {\n\t\tconst fade = t => t * t * t * (t * (t * 6 - 15) + 10);\n\t\tconst lerp = (t, a, b) => a + t * (b - a);\n\t\tconst grad = (hash, x, y, z) => {\n\t\t\thash &= 0xf;\n\t\t\tconst u = hash < 8 ? x : y;\n\t\t\tconst v = hash < 4 ? y : hash == 12 || hash == 14 ? x : z;\n\t\t\treturn ((hash & 0x1) === 0 ? u : -u) + ((hash & 0x2) === 0 ? v : -v);\n\t\t};\n\n\t\tconst xi = x & 0xff;\n\t\tconst yi = y & 0xff;\n\t\tconst zi = z & 0xff;\n\t\tconst xf = x - (x | 0);\n\t\tconst yf = y - (y | 0);\n\t\tconst zf = z - (z | 0);\n\t\tconst u = fade(xf);\n\t\tconst v = fade(yf);\n\t\tconst w = fade(zf);\n\n\t\tconst p = this.#permutation;\n\t\tconst A = p[xi + 0] + yi, AA = p[A] + zi, AB = p[A + 1] + zi;\n\t\tconst B = p[xi + 1] + yi, BA = p[B] + zi, BB = p[B + 1] + zi;\n\n\t\treturn lerp(w,\n\t\t\tlerp(v,\n\t\t\t\tlerp(u, grad(p[AA], xf, yf, zf), grad(p[BA], xf - 1, yf, zf)),\n\t\t\t\tlerp(u, grad(p[AB], xf, yf - 1, zf), grad(p[BB], xf - 1, yf - 1, zf))\n\t\t\t),\n\t\t\tlerp(v,\n\t\t\t\tlerp(u, grad(p[AA + 1], xf, yf, zf - 1), grad(p[BA + 1], xf - 1, yf, zf - 1)),\n\t\t\t\tlerp(u, grad(p[AB + 1], xf, yf - 1, zf - 1), grad(p[BB + 1], xf - 1, yf - 1, zf - 1))\n\t\t\t)\n\t\t);\n\t}\n\n\t#octavePerlin(x, y = 0, z = 0, octaves = 1, persistence = 0.5) {\n\t\tlet total = 0;\n\t\tlet frequency = 1;\n\t\tlet amplitude = 1;\n\t\tlet maxValue = 0;\n\n\t\tfor (let i = 0; i < octaves; ++i) {\n\t\t\ttotal += this.#perlin(x * frequency, y * frequency, z * frequency) * amplitude;\n\t\t\tmaxValue += amplitude;\n\t\t\tamplitude *= persistence;\n\t\t\tfrequency *= 2;\n\t\t}\n\n\t\treturn total / maxValue;\n\t}\n}","import AnimatedCore from \"./animated-core.js\";\n\nexport default class Grayscale extends AnimatedCore {\n\t#alpha = 0;\n\n\tconstructor(duration = undefined, alpha = 1) {\n\t\tsuper(duration);\n\t\tthis.#alpha = alpha;\n\t}\n\n\teffect(src, dst, w, h, level = 1) {\n\t\tthis.#effect(src, dst, w, h, this.#alpha * level);\n\t}\n\n\t#effect(src, dst, w, h, alpha) {\n\t\tconst ralpha = 1 - alpha;\n\t\tfor (let y = 0; y < h; ++y) {\n\t\t\tfor (let x = 0; x < w; ++x) {\n\t\t\t\tconst doffset = y * w + x;\n\t\t\t\tconst color = src[doffset];\n\t\t\t\tconst r = color & 0xff;\n\t\t\t\tconst g = (color >> 8) & 0xff;\n\t\t\t\tconst b = (color >> 16) & 0xff;\n\t\t\t\tconst lu = (0.2126 * r + 0.7152 * g + 0.0722 * b) * alpha;\n\t\t\t\tdst[doffset] = (r * ralpha + lu) | ((g * ralpha + lu) << 8) | ((b * ralpha + lu) << 16) | 0xff << 24;\n\t\t\t}\n\t\t}\n\t}\n}\n","import Effect from \"./effect\";\n\nlet auto = false;\n\nconst params = {\n\tforce: 0,\n\tradius: 0,\n\tweight: 0,\n\tduration: 0,\n\tcycle: 0,\n\tamplitude: 0,\n\toffset: 0,\n};\n\naddEventListener(\"load\", () => {\n\tconst getDefaultParam = id => {\n\t\tconst value = Number(document.getElementById(id).value);\n\t\tparams[id] = value;\n\t\tdocument.getElementById(`now:${id}`).textContent = value;\n\t};\n\n\tauto = document.getElementById(\"auto\").checked;\n\tgetDefaultParam(\"force\");\n\tgetDefaultParam(\"radius\");\n\tgetDefaultParam(\"weight\");\n\tgetDefaultParam(\"duration\");\n\tgetDefaultParam(\"cycle\");\n\tgetDefaultParam(\"amplitude\");\n\tgetDefaultParam(\"offset\");\n\n\tconst canvas = document.getElementById(\"canvas\");\n\tconst image = document.getElementById(\"image\");\n\tconst effect = new Effect.Manager(canvas);\n\tconst bgImage = new Image;\n\tbgImage.src = image.value;\n\tbgImage.addEventListener(\"load\", () => {\n\t\tcanvas.width = bgImage.width;\n\t\tcanvas.height = bgImage.height;\n\t\teffect.updateSize();\n\t}, false);\n\timage.addEventListener(\"change\", e => bgImage.src = e.currentTarget.value);\n\tcanvas.addEventListener(\"mousedown\", e => {\n\t\te = e || window.event;\n\t\tconst cx = e.offsetX || e.layerX - e.target.offsetLeft || 0;\n\t\tconst cy = e.offsetY || e.layerY - e.target.offsetTop || 0;\n\t\tlet radius = params.radius;\n\t\tif (!radius)\n\t\t\tradius = undefined;\n\t\telse if (canvas.clientWidth >= canvas.clientHeight)\n\t\t\tradius = canvas.clientWidth * radius;\n\t\telse\n\t\t\tradius = canvas.clientHeight * radius;\n\t\teffect.add(new Effect.Impact(cx, cy, params.force, radius, params.weight, params.duration, params.cycle, params.amplitude, params.offset));\n\t});\n\n\teffect.add(new Effect.Grayscale(1000, 1));\n\teffect.add(new Effect.PerlinNoise(10000, 1));\n\n\tconst fps = document.getElementById(\"fps\");\n\tlet lastTick = undefined;\n\tlet lastMinuts = undefined;\n\tlet totalFPS = 0;\n\tlet frameCount = 0;\n\tconst draw = tick => {\n\t\tif (!bgImage || !bgImage.complete) {\n\t\t\tsetTimeout(() => requestAnimationFrame(draw), 500);\n\t\t\treturn;\n\t\t}\n\n\t\tif (lastTick === undefined) lastTick = tick;\n\t\ttotalFPS += 1000 / (tick - lastTick);\n\t\t++frameCount;\n\t\tlastTick = tick;\n\n\t\tif (lastMinuts === undefined) lastMinuts = tick;\n\t\tlet minits = (tick - lastMinuts) >= 1000;\n\t\tif (minits) lastMinuts = tick;\n\n\t\tif (minits) {\n\t\t\tfps.textContent = `${canvas.width}x${canvas.height}: ${((totalFPS / frameCount) * 1000 | 0) / 1000} fps`;\n\t\t\ttotalFPS = 0;\n\t\t\tframeCount = 0;\n\t\t\tif (auto)\n\t\t\t\teffect.add(new Effect.Wave(Math.random() * canvas.clientWidth, Math.random() * canvas.clientHeight, params.duration, params.cycle, params.amplitude, params.offset));\n\t\t}\n\n\t\tconst ctx = canvas.getContext(\"2d\");\n\t\tctx.drawImage(bgImage, 0, 0, canvas.clientWidth, canvas.clientHeight);\n\t\teffect.step(tick);\n\t\trequestAnimationFrame(draw);\n\t};\n\trequestAnimationFrame(draw);\n});\n\ndocument.getElementById(\"auto\").addEventListener(\"click\", function (e) { auto = this.checked });\n\nconst setParam = e => {\n\tif (!params || !e.currentTarget) return;\n\tconst value = Number(e.currentTarget.value);\n\tconst id = e.currentTarget.id;\n\tparams[id] = value;\n\tdocument.getElementById(`now:${id}`).textContent = value;\n};\n\ndocument.getElementById(\"force\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"radius\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"weight\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"duration\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"cycle\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"amplitude\").addEventListener(\"change\", setParam);\ndocument.getElementById(\"offset\").addEventListener(\"change\", setParam);"],"names":["AnimatedCore","constructor","duration","this","alive","undefined","step","tick","src","dst","w","h","effect","level","Object","freeze","Manager","canvas","getContext","Error","ImageData","width","height","updateSize","add","push","length","ctx","imageDataSrc","getImageData","Uint32Array","data","buffer","i","set","filter","e","putImageData","cx","cy","cycle","amplitude","offset","super","c","Math","sqrt","PI","dstIndex","y","dy","x","dx","r","dstOffset","d","sin","sx","round","sy","force","radius","weight","srcOffset","distance","alpha","doffset","color","g","b","n","rn","gn","bn","base","Array","map","v","j","random","concat","z","fade","t","lerp","a","grad","hash","u","xi","yi","zi","xf","yf","zf","p","A","AA","AB","B","BA","BB","octaves","persistence","total","frequency","maxValue","ralpha","lu","auto","params","addEventListener","getDefaultParam","id","value","Number","document","getElementById","textContent","checked","image","bgImage","Image","currentTarget","window","event","offsetX","layerX","target","offsetLeft","offsetY","layerY","offsetTop","clientWidth","clientHeight","fps","lastTick","lastMinuts","totalFPS","frameCount","draw","complete","setTimeout","requestAnimationFrame","minits","drawImage","setParam"],"sourceRoot":""}